From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mariell Hoversholm <proximyst@proximyst.com>
Date: Sat, 9 Jan 2021 22:22:59 +0100
Subject: [PATCH] Movement options for armour stands

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.

diff --git a/src/main/java/net/minecraft/server/Block.java b/src/main/java/net/minecraft/server/Block.java
index c276a2896ba73d86e7e18d656903b36d2970ac41..15ec5b8d41509ca886cb699cdcb5b45361b043d6 100644
--- a/src/main/java/net/minecraft/server/Block.java
+++ b/src/main/java/net/minecraft/server/Block.java
@@ -44,6 +44,19 @@ public class Block extends BlockBase implements IMaterial {
         return timing;
     }
     // Paper end
+    // Purpur start
+    public final boolean isFence() {
+        return this == Blocks.ACACIA_FENCE ||
+            this == Blocks.BIRCH_FENCE ||
+            this == Blocks.CRIMSON_FENCE ||
+            this == Blocks.DARK_OAK_FENCE ||
+            this == Blocks.JUNGLE_FENCE ||
+            this == Blocks.NETHER_BRICK_FENCE ||
+            this == Blocks.OAK_FENCE ||
+            this == Blocks.SPRUCE_FENCE ||
+            this == Blocks.WARPED_FENCE;
+    }
+    // Purpur end
     @Nullable
     private String name;
     @Nullable
diff --git a/src/main/java/net/minecraft/server/EntityArmorStand.java b/src/main/java/net/minecraft/server/EntityArmorStand.java
index 6efe59e0385e144c59804e9e5e18e6910b1f6667..9dc7e7b3a6449e642c22d849c5ad585318f464ba 100644
--- a/src/main/java/net/minecraft/server/EntityArmorStand.java
+++ b/src/main/java/net/minecraft/server/EntityArmorStand.java
@@ -52,10 +52,12 @@ public class EntityArmorStand extends EntityLiving {
     private boolean noTickPoseDirty = false;
     private boolean noTickEquipmentDirty = false;
     // Paper end
+    public boolean canMovementTick = true; // Purpur
 
     public EntityArmorStand(EntityTypes<? extends EntityArmorStand> entitytypes, World world) {
         super(entitytypes, world);
         if (world != null) this.canTick = world.paperConfig.armorStandTick; // Paper - armour stand ticking
+        if (world != null) this.canMovementTick = world.purpurConfig.armorstandMovement; // Purpur
         this.handItems = NonNullList.a(2, ItemStack.b);
         this.armorItems = NonNullList.a(4, ItemStack.b);
         this.headPose = EntityArmorStand.bj;
@@ -897,4 +899,18 @@ public class EntityArmorStand extends EntityLiving {
         return true;
     }
     // Paper end
+
+    // Purpur start
+    @Override
+    void aL() {
+        if (this.world.purpurConfig.armorstandWaterMovement &&
+            (this.world.purpurConfig.armorstandWaterFence || !world.getType(getBlockLocation().down()).getBlock().isFence()))
+            super.aL();
+    }
+
+    @Override
+    public void movementTick() {
+        if (this.canMovementTick && this.canMove) super.movementTick();
+    }
+    // Purpur end
 }
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index 0fce0eb902393e28b18b06bea09558f7b5793e0a..242fa7d0acca116f5efcc64066c66b8dca12bce4 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -111,10 +111,16 @@ public class PurpurWorldConfig {
     public boolean armorstandSetNameVisible = false;
     public boolean armorstandFixNametags = false;
     public float armorstandStepHeight = 0.0F;
+    public boolean armorstandMovement = true;
+    public boolean armorstandWaterMovement = true;
+    public boolean armorstandWaterFence = true;
     private void armorstandSettings() {
         armorstandSetNameVisible = getBoolean("gameplay-mechanics.armorstand.set-name-visible-when-placing-with-custom-name", armorstandSetNameVisible);
         armorstandFixNametags = getBoolean("gameplay-mechanics.armorstand.fix-nametags", armorstandFixNametags);
         armorstandStepHeight = (float) getDouble("gameplay-mechanics.armorstand.step-height", armorstandStepHeight);
+        armorstandMovement = getBoolean("gameplay-mechanics.armorstand.can-movement-tick", armorstandMovement);
+        armorstandWaterMovement = getBoolean("gameplay-mechanics.armorstand.can-move-in-water", armorstandWaterMovement);
+        armorstandWaterFence = getBoolean("gameplay-mechanics.armorstand.can-move-in-water-over-fence", armorstandWaterFence);
     }
 
     public boolean controllableMinecarts = false;
